<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <link rel="stylesheet" type="text/css" href="twittler%20styles.css">
    <title>Twittler Inc.</title>
  </head>
  <body>
    <h1>Your Feed</h1>
    <div id="tweet-container"></div>
    <div id="subtweet-container"></div>

    <script>
        var baseIndex = 0;

        function populateTweets () {
            var i;
            for ( i=baseIndex;i<streams.home.length;i++) {
                var tweet = streams.home[i];
                var $tweet = $('<div class="tweet-row" style="display:none;"></div>');
                $tweet.html('@<span class="user-button">' + tweet.user + '</span> ' + tweet.created_at + ': ' + tweet.message);
                $tweet.prependTo($('#tweet-container'));

                // Bind the username-click function to the username span
                $tweet.find(".user-button").on('click',function() {

                    var username = $(this).html();

                    userTweets(username);
                });

                $tweet.slideDown();
            }
            baseIndex = i;
            setTimeout(populateTweets,1500);
        }

        function userTweets (username) {

            $("#subtweet-container").html("");

            console.log("loading user tweets: " + username);
            var i;
            for (i=0;i<streams.users[username].length;i++) {
                var tweet = streams.users[username][i];
                var $tweet = $('<div class="tweet-row" style="display:none;"></div>');
                $tweet.html("@" + tweet.user + ' ' + tweet.created_at + ': ' + tweet.message);
                $tweet.prependTo($('#subtweet-container'));
                $tweet.slideDown();
            }
        }

        $(document).ready(function(){
            populateTweets();
            setTimeout(populateTweets, 1500);
        });
    </script>
  </body>
</html>
